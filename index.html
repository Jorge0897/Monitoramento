<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento PCP | DAFITI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        /* TEMA ESCURO (PADR√ÉO) */
        :root {
            --bg-primary: #111827; --bg-secondary: #1F2937; --bg-tertiary: #374151;
            --border-color: #4B5563; --text-primary: #F3F4F6; --text-secondary: #9CA3AF;
            --accent-primary: #38BDF8; --accent-secondary: #0EA5E9;
            --shadow-color: rgba(56, 189, 248, 0.1); --shadow-color-hover: rgba(56, 189, 248, 0.2);
            --font-main: 'Inter', sans-serif;
        }

        /* TEMA CLARO */
        body.light-theme {
            --bg-primary: #F3F4F6; --bg-secondary: #FFFFFF; --bg-tertiary: #E5E7EB;
            --border-color: #D1D5DB; --text-primary: #1F2937; --text-secondary: #4B5563;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            margin: 0; padding: 0; overflow: hidden;
            transition: background-color 0.3s, color 0.3s;
        }
        
        #splash { position: fixed; inset: 0; background: var(--bg-primary); z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; transition: opacity 0.8s ease-out, visibility 0.8s; }
        #splash.hidden { opacity: 0; visibility: hidden; }
        #splash img { width: 180px; border-radius: 1rem; box-shadow: 0 0 30px rgba(0,0,0,0.5); animation: fadeInLogo 1.5s ease-out forwards; }
        #splash div { font-size: 1.5em; margin-top: 1.5rem; letter-spacing: 2px; font-weight: 500; animation: fadeInText 1.5s 0.2s ease-out forwards; }
        @keyframes fadeInLogo { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes fadeInText { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #card-selection-view { display: flex; flex-direction: column; align-items: center; padding: 2rem; min-height: 100vh; width: 100%; box-sizing: border-box; position: relative; overflow-y: auto; }
        .header { text-align: center; margin-bottom: 1rem; width: 100%; max-width: 1400px; }
        .header h1 { font-size: 2.8rem; font-weight: 700; background: linear-gradient(45deg, var(--accent-primary), var(--text-primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.5rem; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; max-width: 1400px; width: 100%; }
        .card { background-color: var(--bg-secondary); border-radius: 1rem; padding: 2rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; text-align: center; cursor: pointer; border: 1px solid var(--border-color); display: flex; flex-direction: column; align-items: center; }
        .card:hover { transform: translateY(-8px); box-shadow: 0 10px 25px var(--shadow-color-hover); border-color: var(--accent-primary); }
        .card-icon { font-size: 3rem; color: var(--accent-primary); margin-bottom: 1rem; }
        .card-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; }
        #monitoring-view { display: none; width: 100vw; height: 100vh; flex-direction: column; }
        .top-bar { width: 100%; display: flex; align-items: center; justify-content: space-between; background-color: var(--bg-secondary); padding: 0.75rem 1.5rem; box-sizing: border-box; border-bottom: 1px solid var(--border-color); flex-wrap: wrap; gap: 1rem; transition: transform 0.4s ease-in-out; }
        body.presentation-mode .top-bar { transform: translateY(-120%); }
        .top-bar-left, .controls { display: flex; align-items: center; gap: 1rem; }
        #data-hora { font-size: 0.9em; white-space: nowrap; }
        select, input[type="search"], input[type="text"], input[type="number"] { background-color: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 6px 12px; font-size: 0.95em; outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
        .btn { padding: 8px 16px; font-size: 0.95em; background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary)); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: all 0.2s ease; display: flex; align-items: center; gap: 0.5rem; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px var(--shadow-color-hover); }
        .btn.btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); }
        .btn.btn-icon { padding: 8px; }
        .btn.btn-danger { background: #EF4444; }
        #iframe-container { flex-grow: 1; border: none; background: #000; }
        #search-input { padding: 10px 15px; width: 100%; max-width: 500px; margin: 1rem auto 2rem; }
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
        .toast { padding: 12px 20px; border-radius: 8px; color: #fff; font-weight: 500; box-shadow: 0 4px 15px rgba(0,0,0,0.2); opacity: 0; animation: slideInFadeOut 4s ease-in-out forwards; }
        .toast.success { background-color: #22C55E; } .toast.warning { background-color: #F97316; } .toast.info { background-color: #3B82F6; }
        @keyframes slideInFadeOut { 0%, 100% { opacity: 0; transform: translateY(100%); } 10%, 90% { opacity: 1; transform: translateY(0); } }
        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background-color: var(--bg-secondary); padding: 1.5rem; border-radius: 1rem; border: 1px solid var(--border-color); width: 90%; max-width: 700px; }
        .modal-content h2 { font-size: 1.5rem; font-weight: 600; color: var(--accent-primary); margin-top: 0; margin-bottom: 1.5rem; }
        #rotation-checklist { display: flex; flex-direction: column; gap: 0.5rem; max-height: 45vh; overflow-y: auto; padding-right: 5px; border: 1px solid var(--border-color); border-radius: 8px; padding: 0.5rem; }
        .checklist-item { display: flex; align-items: center; gap: 0.75rem; background-color: var(--bg-primary); padding: 0.75rem; border-radius: 8px; cursor: grab; user-select: none; }
        .checklist-item:active { cursor: grabbing; }
        .modal-actions, .group-actions { margin-top: 1.5rem; display: flex; justify-content: space-between; align-items: center; gap: 1rem; flex-wrap: wrap; }
        .sortable-ghost { opacity: 0.4; background: var(--bg-tertiary); }
    </style>
</head>
<body class="dark-theme">
    <div id="splash"><img src="dafiti.gif" alt="Logo"><div>MONITORAMENTO PCP</div></div>

    <main id="app-container" style="opacity:0; transition: opacity 0.8s ease-in;">
        <div id="card-selection-view">
            <div class="header">
                <h1>Painel de Monitoramento</h1>
                <p style="color:var(--text-secondary)">Selecione um dashboard ou busque pelo nome.</p>
                <input type="search" id="search-input" placeholder="üîç Buscar dashboard...">
            </div>
            <div class="cards-grid" id="spreadsheet-cards-container"></div>
        </div>

        <div id="monitoring-view">
            <div class="top-bar">
                <div class="top-bar-left">
                    <h1 style="font-size: 1.25em; font-weight: 600; display:flex; align-items:center; gap:0.75rem;"><img src="dafiti.gif" alt="Logo" style="height:32px; border-radius:8px;"> Monitoramento PCP</h1>
                    <span id="data-hora"></span>
                </div>
                <div class="controls">
                    <button id="back-to-cards-btn" class="btn btn-secondary"><i class="fas fa-arrow-left"></i></button>
                    <div class="control-group">
                        <label for="rotation-group-select" title="Grupo de Rota√ß√£o"><i class="fas fa-layer-group"></i></label>
                        <select id="rotation-group-select"></select>
                    </div>
                    <div class="control-group">
                        <label class="auto-switch-label" title="Ativar/Desativar Rota√ß√£o"><input type="checkbox" id="auto-switch" style="display:none;"><i class="fas fa-sync-alt"></i></label>
                        <label for="intervalo" title="Intervalo (segundos)"><i class="fas fa-clock"></i></label>
                        <input type="number" id="intervalo" value="60" min="5" max="600" step="1" style="width:60px;">
                        <span id="timer-visual"></span>
                    </div>
                    <button id="config-rotation-btn" class="btn btn-icon btn-secondary" title="Configurar Grupos"><i class="fas fa-cog"></i></button>
                    <button id="presentation-mode-btn" class="btn btn-icon btn-secondary" title="Modo Apresenta√ß√£o"><i class="fas fa-desktop"></i></button>
                    <button id="theme-toggle-btn" class="btn btn-icon btn-secondary" title="Alternar Tema"><i class="fas fa-moon"></i></button>
                </div>
            </div>
            <iframe id="iframe-container" src="" frameborder="0"></iframe>
        </div>
    </main>

    <div id="toast-container"></div>
    
    <div id="rotation-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>Configurar Grupos de Rota√ß√£o</h2>
            <div id="rotation-checklist"></div>
            <div class="group-actions">
                 <div style="display:flex; gap: 0.5rem; flex-grow:1;">
                    <input type="text" id="new-group-name" placeholder="Nome do novo grupo..." style="width:100%">
                    <button id="save-new-group-btn" class="btn">Criar</button>
                 </div>
                 <button id="delete-group-btn" class="btn btn-danger">Excluir Grupo</button>
            </div>
            <div class="modal-actions">
                <button id="close-modal-btn" class="btn btn-secondary">Fechar</button>
                <button id="save-rotation-btn" class="btn">Salvar Altera√ß√µes</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const arquivos = [
            { nome: "Capta√ß√£o - Base p. Data", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3JC5-FEU2jjyEiXATzDqDnPPTUQ1CdJ2Au-VpDIYmn50YVpf41SUUT-Apf1ULsASbLSq56RG6zyh3/pubhtml?gid=1438916736&single=true", icon: "fa-tags" },
            { nome: "Capta√ß√£o - Base Oficial", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3JC5-FEU2jjyEiXATzDqDnPPTUQ1CdJ2Au-VpDIYmn50YVpf41SUUT-Apf1ULsASbLSq56RG6zyh3/pubhtml?gid=1510322153&single=true", icon: "fa-tags" },
            { nome: "Cockpit - Processos", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKjdrUXdCJiDbv7WVfR8p0cs5O0DR_0yQodEgb2QSDeyNiWAE96TNjQZUD_il5KuN2y3LmAbL3IfZx/pubhtml?gid=1594703048&single=true", icon: "fa-tags" },
            { nome: "Cockpit - Retail (Grupos)", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKjdrUXdCJiDbv7WVfR8p0cs5O0DR_0yQodEgb2QSDeyNiWAE96TNjQZUD_il5KuN2y3LmAbL3IfZx/pubhtml?gid=1646909923&single=true", icon: "fa-tags" },
            { nome: "Cockpit Opera√ß√µes - Fulfillment (Grupos)", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKjdrUXdCJiDbv7WVfR8p0cs5O0DR_0yQodEgb2QSDeyNiWAE96TNjQZUD_il5KuN2y3LmAbL3IfZx/pubhtml?gid=1022639883&single=true", icon: "fa-tags" },
            { nome: "Cockpit Opera√ß√µes - Retail + MR - MR puro (Grupos)", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKjdrUXdCJiDbv7WVfR8p0cs5O0DR_0yQodEgb2QSDeyNiWAE96TNjQZUD_il5KuN2y3LmAbL3IfZx/pubhtml?gid=616418256&single=true" ,icon: "fa-tags" },
            { nome: "Cockpit - Fulfillment", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKjdrUXdCJiDbv7WVfR8p0cs5O0DR_0yQodEgb2QSDeyNiWAE96TNjQZUD_il5KuN2y3LmAbL3IfZx/pubhtml?gid=1022639883&single=true", icon: "fa-tags" },
            { nome: "Cockpit - Milk Run", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTKjdrUXdCJiDbv7WVfR8p0cs5O0DR_0yQodEgb2QSDeyNiWAE96TNjQZUD_il5KuN2y3LmAbL3IfZx/pubhtml?gid=116624029&single=true", icon: "fa-tags" },
            { nome: "Backlog - Inbound", url:"https://docs.google.com/spreadsheets/d/e/2PACX-1vTFktZyFmfALarBt5jAszR94F1EwAdxzpq10dkIc9diHH0uElrY7sRxGFv9Jke8IPcml2sfMeYaHLKz/pubhtml?gid=577403338&single=true", icon: "fa-tags" },
            { nome: "Monitoramento DL", url:"https://docs.google.com/spreadsheets/d/e/2PACX-1vTuW2k1M-gzxULcbPsPhy-I3YYY56TZsx5UYHwNUBrqNBoPWbW71j5WeZncrxe1GR-1bNlfjKJWlKrC/pubhtml?gid=238164626&single=true", icon: "fa-tags" },
            { nome: "Estoque (Power BI)", url:"https://app.powerbi.com/view?r=eyJrIjoiMDkxMDAwMDYtYjc5My00OTA0LWIyNWUtNGJlZTUxNDdmNjgxIiwidCI6IjEwZmZhYTFiLTA0ZDEtNDBiMC05OTIzLTJmN2ViZmUxMmM1NCJ9", icon: "fa-chart-pie" }
        ];

        let indiceAtual = 0, autoSwitch = false, intervalo = 60;
        let intervalId = null, tempoRestante = intervalo, timerVisualId = null;
        let rotationGroups = {}, activeGroupName = 'Padr√£o';

        const dom = {
            splash: document.getElementById('splash'), appContainer: document.getElementById('app-container'),
            cardSelectionView: document.getElementById('card-selection-view'), spreadsheetCardsContainer: document.getElementById('spreadsheet-cards-container'),
            searchInput: document.getElementById('search-input'),
            monitoringView: document.getElementById('monitoring-view'), iframe: document.getElementById('iframe-container'),
            dataHoraSpan: document.getElementById('data-hora'), backToCardsBtn: document.getElementById('back-to-cards-btn'),
            rotationGroupSelect: document.getElementById('rotation-group-select'),
            autoSwitchInput: document.getElementById('auto-switch'), autoSwitchLabel: document.querySelector(".auto-switch-label i"),
            intervaloInput: document.getElementById("intervalo"), timerSpan: document.getElementById("timer-visual"),
            configRotationBtn: document.getElementById('config-rotation-btn'), presentationModeBtn: document.getElementById('presentation-mode-btn'),
            themeToggleBtn: document.getElementById('theme-toggle-btn'), toastContainer: document.getElementById('toast-container'),
            rotationModal: document.getElementById('rotation-modal'), rotationChecklist: document.getElementById('rotation-checklist'),
            closeModalBtn: document.getElementById('close-modal-btn'), saveRotationBtn: document.getElementById('save-rotation-btn'),
            newGroupNameInput: document.getElementById('new-group-name'), saveNewGroupBtn: document.getElementById('save-new-group-btn'),
            deleteGroupBtn: document.getElementById('delete-group-btn'),
        };

        const showToast = (message, type = 'info') => {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            dom.toastContainer.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        };

        const showView = (view) => {
            dom.cardSelectionView.style.display = view === 'cards' ? 'flex' : 'none';
            dom.monitoringView.style.display = view === 'monitor' ? 'flex' : 'none';
        }

        const carregarEstado = () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.body.className = `${savedTheme}-theme`;
            dom.themeToggleBtn.innerHTML = savedTheme === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            const savedGroups = localStorage.getItem('rotationGroups');
            rotationGroups = savedGroups ? JSON.parse(savedGroups) : { 'Padr√£o': arquivos.map((_, i) => i) };
            activeGroupName = localStorage.getItem('activeGroupName') || 'Padr√£o';
            autoSwitch = localStorage.getItem('autoSwitch') === 'true';
            intervalo = Number(localStorage.getItem('intervalo')) || 60;
            dom.autoSwitchInput.checked = autoSwitch;
            dom.intervaloInput.value = intervalo;
            atualizarIconeAutoSwitch();
            populateGroupSelect();
        };

        const salvarEstado = () => {
            localStorage.setItem('theme', document.body.classList.contains('light-theme') ? 'light' : 'dark');
            localStorage.setItem('rotationGroups', JSON.stringify(rotationGroups));
            localStorage.setItem('activeGroupName', activeGroupName);
            localStorage.setItem('autoSwitch', autoSwitch);
            localStorage.setItem('intervalo', intervalo);
        };
        
        const filterCards = () => {
            const searchTerm = dom.searchInput.value.toLowerCase();
            const cards = dom.spreadsheetCardsContainer.children;
            for (const card of cards) {
                const title = card.querySelector('.card-title').textContent.toLowerCase();
                card.style.display = title.includes(searchTerm) ? 'flex' : 'none';
            }
        };

        const toggleTheme = () => {
            document.body.classList.toggle('light-theme');
            document.body.classList.toggle('dark-theme');
            const isLight = document.body.classList.contains('light-theme');
            dom.themeToggleBtn.innerHTML = isLight ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            salvarEstado();
            showToast(`Tema alterado para ${isLight ? 'Claro' : 'Escuro'}`);
        };

        const togglePresentationMode = () => {
            document.body.classList.toggle('presentation-mode');
            const isInPresMode = document.body.classList.contains('presentation-mode');
            if (isInPresMode && !document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => console.error(err));
            } else if (!isInPresMode && document.fullscreenElement) {
                document.exitFullscreen();
            }
        };

        const populateGroupSelect = () => {
            dom.rotationGroupSelect.innerHTML = '';
            for (const groupName in rotationGroups) {
                const option = document.createElement('option');
                option.value = groupName;
                option.textContent = groupName;
                option.selected = groupName === activeGroupName;
                dom.rotationGroupSelect.appendChild(option);
            }
        };

        const openRotationModal = () => {
            dom.rotationChecklist.innerHTML = '';
            const currentGroupList = rotationGroups[activeGroupName] || [];
            currentGroupList.forEach(index => dom.rotationChecklist.appendChild(createChecklistItem(index, true)));
            arquivos.forEach((_, index) => {
                if (!currentGroupList.includes(index)) {
                    dom.rotationChecklist.appendChild(createChecklistItem(index, false));
                }
            });
            new Sortable(dom.rotationChecklist, { animation: 150, ghostClass: 'sortable-ghost' });
            dom.rotationModal.classList.add('visible');
        };
        
        const createChecklistItem = (index, isChecked) => {
             const item = document.createElement('div');
             item.className = 'checklist-item';
             item.innerHTML = `<input type="checkbox" value="${index}" ${isChecked ? 'checked' : ''} style="width:1.2rem; height:1.2rem; accent-color:var(--accent-primary)"><i class="fas ${arquivos[index].icon} fa-fw" style="color:var(--text-secondary)"></i><span>${arquivos[index].nome}</span>`;
             return item;
        };

        const saveCurrentGroupChanges = () => {
            const items = Array.from(dom.rotationChecklist.children);
            const newList = items
                .filter(item => item.querySelector('input').checked)
                .map(item => Number(item.querySelector('input').value));
            
            rotationGroups[activeGroupName] = newList;
            salvarEstado();
            gerenciarTrocaAutomatica();
            showToast(`Grupo '${activeGroupName}' atualizado!`, 'success');
        };

        const saveNewGroup = () => {
            const groupName = dom.newGroupNameInput.value.trim();
            if (!groupName) return showToast('Por favor, insira um nome para o grupo.', 'warning');
            if (rotationGroups[groupName]) return showToast('J√° existe um grupo com este nome.', 'warning');
            
            activeGroupName = groupName;
            rotationGroups[activeGroupName] = []; 
            saveCurrentGroupChanges();
            populateGroupSelect();
            dom.newGroupNameInput.value = '';
            showToast(`Grupo '${groupName}' criado e salvo!`, 'success');
        };
        
        const deleteActiveGroup = () => {
            if (Object.keys(rotationGroups).length <= 1) return showToast('N√£o √© poss√≠vel excluir o √∫ltimo grupo.', 'warning');
            if (confirm(`Tem certeza que deseja excluir o grupo '${activeGroupName}'?`)) {
                delete rotationGroups[activeGroupName];
                activeGroupName = Object.keys(rotationGroups)[0];
                populateGroupSelect();
                salvarEstado();
                showToast(`Grupo exclu√≠do.`, 'info');
            }
        };
        
        const mostrarPlanilha = (index) => {
            indiceAtual = index;
            dom.iframe.src = arquivos[index].url;
        };
        
        const proximaPlanilha = () => {
            const rotationList = rotationGroups[activeGroupName] || [];
            if (rotationList.length === 0) return;
            const currentIndexInRotation = rotationList.indexOf(indiceAtual);
            const nextIndexInRotation = (currentIndexInRotation === -1 || currentIndexInRotation >= rotationList.length - 1) ? 0 : currentIndexInRotation + 1;
            mostrarPlanilha(rotationList[nextIndexInRotation]);
        };

        const gerenciarTrocaAutomatica = () => {
             if (intervalId) clearInterval(intervalId);
             if (timerVisualId) clearInterval(timerVisualId);
             
             const rotationList = rotationGroups[activeGroupName] || [];
             atualizarTimerVisual();
             if (autoSwitch && rotationList.length > 0) {
                intervalId = setInterval(proximaPlanilha, intervalo * 1000);
                tempoRestante = intervalo;
                timerVisualId = setInterval(() => {
                    tempoRestante = tempoRestante <= 1 ? intervalo : tempoRestante - 1;
                    atualizarTimerVisual();
                }, 1000);
             }
        };

        const atualizarTimerVisual = () => {
            const rotationList = rotationGroups[activeGroupName] || [];
            dom.timerSpan.textContent = autoSwitch && rotationList.length > 0 ? `${tempoRestante}s` : '';
        }

        const atualizarIconeAutoSwitch = () => {
             dom.autoSwitchLabel.style.color = autoSwitch ? 'var(--accent-primary)' : '';
             dom.autoSwitchLabel.style.animation = autoSwitch ? 'spin 2s linear infinite' : 'none';
        }

        const createSpreadsheetCard = (item, index) => { 
             const card = document.createElement('div');
             card.className = 'card';
             card.innerHTML = `<i class="fas ${item.icon} card-icon"></i><h2 class="card-title">${item.nome}</h2><p class="card-description">${item.description || ''}</p>`;
             card.addEventListener('click', () => { showView('monitor'); mostrarPlanilha(index); });
             dom.spreadsheetCardsContainer.appendChild(card);
        }

        const init = () => {
            carregarEstado();
            arquivos.forEach((item, index) => createSpreadsheetCard(item, index));
            
            dom.searchInput.addEventListener('input', filterCards);
            dom.themeToggleBtn.addEventListener('click', toggleTheme);
            dom.presentationModeBtn.addEventListener('click', togglePresentationMode);
            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement) document.body.classList.remove('presentation-mode');
            });

            dom.configRotationBtn.addEventListener('click', openRotationModal);
            dom.closeModalBtn.addEventListener('click', () => dom.rotationModal.classList.remove('visible'));
            dom.saveRotationBtn.addEventListener('click', () => { saveCurrentGroupChanges(); dom.rotationModal.classList.remove('visible'); });
            dom.saveNewGroupBtn.addEventListener('click', saveNewGroup);
            dom.deleteGroupBtn.addEventListener('click', deleteActiveGroup);
            
            dom.rotationGroupSelect.addEventListener('change', (e) => {
                activeGroupName = e.target.value;
                salvarEstado();
                gerenciarTrocaAutomatica();
            });
            
            dom.autoSwitchLabel.parentElement.addEventListener('click', () => {
                autoSwitch = !autoSwitch;
                dom.autoSwitchInput.checked = autoSwitch;
                showToast(`Rota√ß√£o autom√°tica ${autoSwitch ? 'iniciada' : 'pausada'}.`, 'info');
                atualizarIconeAutoSwitch();
                gerenciarTrocaAutomatica();
                salvarEstado();
            });

            dom.intervaloInput.addEventListener('input', () => {
                const val = Number(dom.intervaloInput.value);
                if(val >= 5 && val <= 600){
                    intervalo = val;
                    salvarEstado();
                    gerenciarTrocaAutomatica();
                }
            });

            dom.backToCardsBtn.addEventListener('click', () => showView('cards'));

            setInterval(() => { dom.dataHoraSpan.textContent = new Date().toLocaleString('pt-BR'); }, 1000);
            
            setTimeout(() => {
                dom.splash.classList.add('hidden');
                dom.appContainer.style.opacity = 1;
            }, 1500);
        };

        init();
    });
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado com sucesso:', registration);
                    })
                    .catch(error => {
                        console.log('‚ùå Falha ao registrar o Service Worker:', error);
                    });
            });
        }
    </script>
</body>
</html>
